# ZotWatch Configuration

zotero:
  mode: "api"
  api:
    user_id: "${ZOTERO_USER_ID}"
    api_key: "${ZOTERO_API_KEY}"
    page_size: 100
    polite_delay_ms: 200

sources:
  arxiv:
    enabled: false
    categories:
      - "cs.LG"   # Machine Learning
      - "cs.CV"   # Computer Vision and Pattern Recognition
      - "cs.AI"   # Artificial Intelligence
      - "stat.ML" # Machine Learning (Statistics)
    days_back: 4
    max_results: 3000
  crossref:
    enabled: true
    mailto: "${CROSSREF_MAILTO}"
    days_back: 2
    max_results: 10
  # Abstract scraper (Camoufox + rule-based + LLM fallback)
  scraper:
    enabled: true
    rate_limit_delay: 1.0
    timeout: 60000
    max_retries: 2
    max_html_chars: 15000
    llm_max_tokens: 1024
    llm_temperature: 0.1
    use_llm_fallback: true

scoring:
  # Threshold configuration: controls how papers are labeled (must_read/consider/ignore)
  thresholds:
    mode: "dynamic"  # "fixed" (static thresholds) or "dynamic" (percentile-based)
    must_read: 0.75  # Fixed mode: must_read threshold
    consider: 0.55   # Fixed mode: consider threshold
    dynamic:         # Dynamic mode: percentile-based thresholds
      must_read_percentile: 95  # Top 5% as must_read
      consider_percentile: 70   # 70th-95th percentile as consider
      min_must_read: 0.60       # Minimum score floor for must_read
      min_consider: 0.40        # Minimum score floor for consider

  # User research interests for interest-based recommendations (optional)
  interests:
    enabled: true
    description: |
        ç ”ç©¶ä»¥äº²é“œå…ƒç´ ï¼ˆCuã€Agã€Au ç­‰ï¼‰åœ°çƒåŒ–å­¦ä¸ºæ ¸å¿ƒï¼Œ
        å…³æ³¨å…¶åœ¨ç±»åœ°è¡Œæ˜Ÿä¸åŒåœˆå±‚ä¸­çš„åˆ†å¸ƒã€åˆ†é…ä¸è¿ç§»è¡Œä¸ºï¼Œ
        ç”¨äºè®¤è¯†æ ¸å¹”åˆ†å¼‚ä»¥åŠåœ°çƒå£³å¹”æ¼”åŒ–è¿‡ç¨‹ã€‚
        é‡ç‚¹é—®é¢˜åŒ…æ‹¬ï¼š
        - æ·±éƒ¨åœ°å¹”å²©æµ†è¿‡ç¨‹ä¸­äº²é“œå…ƒç´ ä¸é‡‘å±åŒä½ç´ è¡Œä¸ºï¼›
        - å¤§æ´‹â€”å¤§é™†ä¿¯å†²å¸¦ä¸­é‡‘å±å…ƒç´ ä¸æŒ¥å‘åˆ†ï¼ˆä»¥ç¡«ã€å¤ç´ å’Œç¢³ä¸ºä¸»ï¼‰çš„èµ·æºã€è¿ç§»ä¸å¾ªç¯ï¼›
        - äº²é“œå…ƒç´ ç›¸å…³çš„æˆçŸ¿è¿‡ç¨‹ã€èµ„æºæ½œåŠ›ä¸ç¯å¢ƒæ•ˆåº”ï¼› 
        æ˜ç¡®æ’é™¤ç”Ÿç‰©åŒ»å­¦ã€ç”Ÿå‘½ç§‘å­¦åŠä¸´åºŠç ”ç©¶ã€‚
    max_documents: 50  # Max documents for FAISS recall (Voyage limit: 1000, DashScope: 500)
    top_k_interest: 5  # Final interest-based papers count

  # Rerank settings (only used when interests.enabled=true)
  # Provider MUST match embedding.provider when interests are enabled
  rerank:
    provider: "dashscope"  # Options: "voyage" or "dashscope"
    model: "qwen3-rerank"  # voyage: rerank-2/rerank-2.5, dashscope: qwen3-rerank

  # Journal impact factor scoring configuration
  journal:
    arxiv_score: 0.0          # Score for arXiv preprints
    chinese_core_score: 0.7   # Score for Chinese core journals
    unknown_score: 0.3        # Score for unknown journals
    log_base: 25.0            # Log base for IF normalization

  # Final score composition weights
  # score = similarity_weight * similarity + impact_factor_weight * if_score
  final_weights:
    similarity_weight: 0.8      # Weight for embedding similarity
    impact_factor_weight: 0.2   # Weight for journal impact factor

# Embedding configuration (provider MUST match rerank.provider when interests are enabled)
embedding:
  provider: "dashscope"  # Options: "voyage" or "dashscope"
  model: "text-embedding-v4"  # voyage: voyage-3.5, dashscope: text-embedding-v3
  api_key: "${DASHSCOPE_API_KEY}"  # voyage: VOYAGE_API_KEY, dashscope: DASHSCOPE_API_KEY
  batch_size: 10  # For DashScope models, must be <=10

# LLM configuration for AI summaries and translation
llm:
  enabled: true
  provider: "kimi"  # Options: "kimi", "openrouter", or "deepseek"
  api_key: "${MOONSHOT_API_KEY}"  # kimi: MOONSHOT_API_KEY
  model: "kimi-k2-turbo-preview"
  max_tokens: 5120
  temperature: 0.3
  retry:
    max_attempts: 3
    backoff_factor: 2.0
    initial_delay: 1.0
  translation:
    enabled: true  # Translate English titles to Chinese

# Output Configuration
output:
  timezone: "Asia/Shanghai"  # IANA timezone name (e.g., "UTC", "America/New_York")
  rss:
    title: "ZotWatch Feed"
    link: "https://ehehe.cn/zotwatch/"
    description: "AI-assisted literature watch"
  html:
    template: "report.html"
    include_summaries: true

# Profile analysis configuration
profile:
  exclude_tags:  # Drop these tags during Zotero ingest (personal markers)
    - "â³"
    - "âœ”ï¸"
    - "ğŸ’"
    - "/done"
    - "/reading"
    - "/unread"
    - "â­"
    - "â­â­"
    - "â­â­â­"
    - "â­â­â­â­"
    - "â­â­â­â­â­"
  author_min_count: 10  # Minimum appearances for "frequent author"
  # Clustering configuration for semantic grouping of research papers
  # Uses adaptive Silhouette-based clustering with automatic k selection
  clustering:
    enabled: true
    max_clusters: 35               # Upper limit on cluster count
    min_cluster_size: 1            # Minimum papers per valid cluster (1 = allow single-paper clusters)
    biased_k_tolerance_percent: 0.10  # Within 10% of best Silhouette score, select the largest k
    generate_labels: true          # Use LLM to generate cluster labels
    # Temporal weighting for time-decay of paper relevance
    temporal:
      enabled: true
      halflife_days: 180           # Papers half as relevant after 6 months
      min_weight: 0.05             # Floor weight for very old papers

# Watch pipeline configuration
watch:
  recent_days: 7          # Filter papers older than N days
  max_preprint_ratio: 0.9 # Max preprint ratio in results
  top_k: 20               # Default recommendation count
  require_abstract: true  # Filter out papers without abstracts
