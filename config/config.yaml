# ZotWatch Configuration

zotero:
  mode: "api"
  api:
    user_id: "${ZOTERO_USER_ID}"
    api_key: "${ZOTERO_API_KEY}"
    page_size: 100
    polite_delay_ms: 200

sources:
  arxiv:
    enabled: false
    categories:
      - "cs.LG"   # Machine Learning
      - "cs.CV"   # Computer Vision and Pattern Recognition
      - "cs.AI"   # Artificial Intelligence
      - "stat.ML" # Machine Learning (Statistics)
    days_back: 4
    max_results: 3000
  crossref:
    enabled: true
    mailto: "${CROSSREF_MAILTO}"
    days_back: 2
    max_results: 3000
  # EarthArXiv preprints (Earth sciences via OSF)
  eartharxiv:
    enabled: true  # Enable to get Earth science preprints
    days_back: 7
    max_results: 200
  # Abstract scraper (Camoufox + rule-based + LLM fallback)
  scraper:
    enabled: true
    rate_limit_delay: 1.0
    timeout: 60000
    max_retries: 2
    max_html_chars: 15000
    llm_max_tokens: 1024
    llm_temperature: 0.1
    use_llm_fallback: true

scoring:
  # Threshold configuration: controls how papers are labeled (must_read/consider/ignore)
  thresholds:
    mode: "dynamic"  # "fixed" (static thresholds) or "dynamic" (percentile-based)
    must_read: 0.75  # Fixed mode: must_read threshold
    consider: 0.55   # Fixed mode: consider threshold
    dynamic:         # Dynamic mode: percentile-based thresholds
      must_read_percentile: 95  # Top 5% as must_read
      consider_percentile: 70   # 70th-95th percentile as consider
      min_must_read: 0.60       # Minimum score floor for must_read
      min_consider: 0.40        # Minimum score floor for consider

  # User research interests for interest-based recommendations (optional)
  interests:
    enabled: true
    description: |
      æˆ‘æ˜¯ä¸€ååœ°çƒåŒ–å­¦/å²©çŸ³å­¦æ–¹å‘çš„ç ”ç©¶è€…ï¼Œé‡ç‚¹å…³æ³¨ä»¥ä¸‹ç ”ç©¶æ–¹å‘ï¼š
      1) æ·±éƒ¨åœ°å¹”å²©æµ†è¿‡ç¨‹ä»¥åŠä¿¯å†²è¿‡ç¨‹ä¸­äº²é“œå…ƒç´ ï¼ˆCuã€Agã€Au ç­‰ï¼‰ä¸é‡‘å±åŒä½ç´ è¡Œä¸ºï¼›
      2) å¤§æ´‹â€”å¤§é™†ä¿¯å†²å¸¦ä¸­é‡‘å±å…ƒç´ ä¸æŒ¥å‘åˆ†ï¼ˆä»¥ç¡«ã€å¤ç´ å’Œç¢³ä¸ºä¸»ï¼‰çš„èµ·æºã€è¿ç§»ä¸å¾ªç¯ï¼›
      3) äº²é“œå…ƒç´ ç›¸å…³çš„æˆçŸ¿è¿‡ç¨‹ã€èµ„æºæ½œåŠ›ä¸ç¯å¢ƒæ•ˆåº”ï¼›
      4) æˆ‘åªå…³æ³¨åœ°å­¦é¢†åŸŸçš„ç ”ç©¶(geochemistry, petrology, volcanology, geology, mineralogy)ã€‚
      
      ã€é‡è¦ï¼šè¯·æ˜ç¡®æ’é™¤ä»¥ä¸‹é¢†åŸŸã€‘
      - ææ–™ç§‘å­¦(materials science)ï¼šå¦‚çº³ç±³ææ–™ã€ç”µæ± ææ–™ã€å‚¬åŒ–å‰‚ã€è–„è†œã€åˆé‡‘ã€åŠå¯¼ä½“ã€èšåˆç‰©ã€æ¶‚å±‚
      - åŒ–å­¦å·¥ç¨‹(chemical engineering)ï¼šå¦‚åŒ–å·¥ååº”å™¨ã€åˆ†ç¦»å·¥è‰ºã€èƒå–å·¥ä¸š
      - ç”Ÿç‰©åŒ»å­¦(biomedical)ï¼šå¦‚è¯ç‰©é€’é€ã€ç”Ÿç‰©ä¼ æ„Ÿå™¨ã€åŒ»ç”¨ææ–™
      - ç¯å¢ƒå·¥ç¨‹(environmental engineering)ï¼šå¦‚åºŸæ°´å¤„ç†ã€æ±¡æŸ“ç‰©é™è§£ã€å¸é™„ææ–™
      - é£Ÿå“ç§‘å­¦ã€å†œä¸šåŒ–å­¦ã€ç”µåŒ–å­¦ç”µæ± ã€å…‰ç”µææ–™ã€è¶…å¯¼ææ–™ã€ç£æ€§ææ–™
    max_documents: 500  # Max documents for FAISS recall (Voyage limit: 1000, DashScope: 500)
    top_k_interest: 5  # Final interest-based papers count
    # Static exclude keywords (case-insensitive, applied to ALL candidates)
    # ç”¨äºè¿‡æ»¤ Nature/Science ç­‰ç»¼åˆæ€§æœŸåˆŠä¸­çš„éåœ°å­¦æ–‡ç« 
    exclude_keywords:
      # ===== Materials Science & Engineering =====
      - "nanomaterial"
      - "nanoparticle"
      - "nanocomposite"
      - "nanotube"
      - "graphene"
      - "thin film"
      - "thin-film"
      - "battery"
      - "lithium-ion"
      - "lithium ion"
      - "electrode"
      - "anode"
      - "cathode"
      - "electrochemical cell"
      - "photovoltaic"
      - "solar cell"
      - "superconductor"
      - "semiconductor"
      - "transistor"
      - "polymer"
      - "coating"
      - "alloy"
      - "catalyst"
      - "photocatalyst"
      - "electrocatalyst"
      - "metamaterial"
      - "meta-lens"
      - "metasurface"
      
      # ===== Physics (Quantum/Optics/Condensed Matter) =====
      - "quantum computing"
      - "quantum bit"
      - "qubit"
      - "quantum entanglement"
      - "superposition"
      - "quantum spin"
      - "levitating magnet"
      - "metal-insulator transition"
      - "wavefront shaping"
      - "photonics"
      - "optical fiber"
      - "laser"
      - "plasmon"
      - "phosphorescence"
      - "luminescence"
      - "LED"
      - "light-emitting"
      
      # ===== Biomedical & Pharmaceutical =====
      - "drug delivery"
      - "biosensor"
      - "biomedical"
      - "pharmaceutical"
      - "therapeutic"
      - "nanocarrier"
      - "tissue engineering"
      - "clinical trial"
      - "cancer therapy"
      - "tumor"
      - "chemotherapy"
      - "immunotherapy"
      - "antibody"
      - "vaccine"
      - "analgesia"
      - "pain relief"
      - "depression"
      - "nanobody"
      
      # ===== Molecular Biology & Genetics =====
      - "gene expression"
      - "gene regulation"
      - "CRISPR"
      - "genome editing"
      - "transcription"
      - "mRNA"
      - "protein folding"
      - "enzyme catalysis"
      - "polysaccharide"
      - "endocytosis"
      - "cell signaling"
      - "neural"
      - "neuron"
      - "brain"
      - "synapse"
      
      # ===== Agricultural & Food Science =====
      - "food science"
      - "food processing"
      - "agrochemical"
      - "transgenic rice"
      - "crop yield"
      - "plant breeding"
      - "pesticide"
      
      # ===== Environmental Engineering (non-geological) =====
      - "wastewater"
      - "sewage"
      - "pollutant degradation"
      - "adsorption material"
      - "membrane separation"
      - "drinking water treatment"
      - "air pollution"
      
      # ===== Other Non-Geoscience =====
      - "woven metamaterial"
      - "3D printing"
      - "additive manufacturing"
      - "artificial intelligence"
      - "machine learning"
      - "deep learning"
      - "neural network"
      - "daily briefing"
      - "news feature"


  # Micro/Macro fusion scoring configuration
  fusion:
    micro_weight: 0.65  # Î±: weight for micro-level score (1-Î± for macro)
    knn_neighbors: 5    # Number of neighbors for k-NN scoring
    # Similarity gate: filter out candidates with low relevance to your library
    # This is the key setting to filter Nature/Science papers not related to geoscience
    similarity_gate_enabled: true
    min_similarity: 0.30  # Minimum similarity threshold (0.0-1.0, higher = stricter)

  # Rerank settings (only used when interests.enabled=true)
  # Provider MUST match embedding.provider when interests are enabled
  rerank:
    provider: "dashscope"  # Options: "voyage" or "dashscope"
    model: "qwen3-rerank"  # voyage: rerank-2/rerank-2.5, dashscope: qwen3-rerank

  # Journal impact factor scoring configuration
  journal:
    arxiv_score: 0.6          # Score for arXiv preprints
    chinese_core_score: 0.7   # Score for Chinese core journals
    unknown_score: 0.3        # Score for unknown journals
    log_base: 25.0            # Log base for IF normalization

  # Final score composition weights
  # score = similarity_weight * similarity + impact_factor_weight * if_score
  final_weights:
    similarity_weight: 0.8      # Weight for embedding similarity
    impact_factor_weight: 0.2   # Weight for journal impact factor

# Embedding configuration (provider MUST match rerank.provider when interests are enabled)
embedding:
  provider: "dashscope"  # Options: "voyage" or "dashscope"
  model: "text-embedding-v4"  # voyage: voyage-3.5, dashscope: text-embedding-v3
  api_key: "${DASHSCOPE_API_KEY}"  # voyage: VOYAGE_API_KEY, dashscope: DASHSCOPE_API_KEY
  batch_size: 10  # For DashScope models, must be <=10

# LLM configuration for AI summaries and translation
llm:
  enabled: true
  provider: "openrouter"  # Options: "kimi", "openrouter", or "deepseek"
  api_key: "${OPENROUTER_API_KEY}"  # kimi: MOONSHOT_API_KEY
  model: "gemini-2.5-flash"
  max_tokens: 5120
  temperature: 0.3
  retry:
    max_attempts: 3
    backoff_factor: 2.0
    initial_delay: 1.0
  translation:
    enabled: true  # Translate English titles to Chinese

# Output Configuration
output:
  timezone: "Asia/Shanghai"  # IANA timezone name (e.g., "UTC", "America/New_York")
  rss:
    title: "ZotWatch Feed"
    link: "https://ehehe.cn/zotwatch/"
    description: "AI-assisted literature watch"
  html:
    template: "report.html"
    include_summaries: true

# Profile analysis configuration
profile:
  exclude_tags:  # Drop these tags during Zotero ingest (personal markers)
    - "â³"
    - "âœ”ï¸"
    - "ğŸ’"
    - "/done"
    - "/reading"
    - "/unread"
    - "â­"
    - "â­â­"
    - "â­â­â­"
    - "â­â­â­â­"
    - "â­â­â­â­â­"
  author_min_count: 5  # Minimum appearances for "frequent author"
  # Clustering configuration for semantic grouping of research papers
  # Uses adaptive Silhouette-based clustering with automatic k selection
  clustering:
    enabled: true
    max_clusters: 35               # Upper limit on cluster count
    min_clusters: 5                # Lower limit on cluster count (prevents too few clusters)
    min_cluster_size: 1            # Minimum papers per valid cluster (1 = allow single-paper clusters)
    biased_k_tolerance_percent: 0.20  # Within 20% of best Silhouette score, select the largest k
    generate_labels: true          # Use LLM to generate cluster labels
    # Temporal weighting for time-decay of paper relevance
    temporal:
      enabled: false
      halflife_days: 365           # Papers half as relevant after 6 months
      min_weight: 0.05             # Floor weight for very old papers

# Watch pipeline configuration
watch:
  recent_days: 7          # Filter papers older than N days
  max_preprint_ratio: 0.9 # Max preprint ratio in results
  top_k: 20               # Default recommendation count
  require_abstract: true  # Filter out papers without abstracts
